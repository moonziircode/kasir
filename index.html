<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="space-y-2">
                    <div class="grid grid-cols-4 gap-2">
                        <button class="cash-denomination-btn bg-gray-200 text-gray-800 py-2 rounded-lg text-xs font-medium hover:bg-gray-300" data-amount="100000">100rb</button>
                        <button class="cash-denomination-btn bg-gray-200 text-gray-800 py-2 rounded-lg text-xs font-medium hover:bg-gray-300" data-amount="50000">50rb</button>
                        <button class="cash-denomination-btn bg-gray-200 text-gray-800 py-2 rounded-lg text-xs font-medium hover:bg-gray-300" data-amount="20000">20rb</button>
                        <button class="cash-denomination-btn bg-gray-200 text-gray-800 py-2 rounded-lg text-xs font-medium hover:bg-gray-300" data-amount="10000">10rb</button>
                    </div>
                    <div class="grid grid-cols-4 gap-2">
                        <button class="cash-denomination-btn bg-gray-200 text-gray-800 py-2 rounded-lg text-xs font-medium hover:bg-gray-300" data-amount="5000">5rb</button>
                        <button class="cash-denomination-btn bg-gray-200 text-gray-800 py-2 rounded-lg text-xs font-medium hover:bg-gray-300" data-amount="2000">2rb</button>
                        <button class="cash-denomination-btn bg-gray-200 text-gray-800 py-2 rounded-lg text-xs font-medium hover:bg-gray-300" data-amount="1000">1rb</button>
                        <button id="exact-cash-btn" class="bg-blue-100 text-blue-800 py-2 rounded-lg text-xs font-bold hover:bg-blue-200">Uang Pas</button>
                    </div>
                </div>
                <div class="flex justify-between items-center pt-2">
                    <span class="text-base font-medium text-gray-700">Kembalian</span>
                    <span id="change-amount" class="text-xl font-bold text-green-600">Rp 0</span>
                </div>
            </div>
        </div>

        <!-- Save Transaction Button -->
        <button id="save-transaction-btn" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out hidden">
            Simpan Transaksi
        </button>
        
        <!-- Success Message Modal -->
        <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                <svg class="mx-auto h-12 w-12 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h3 class="mt-2 text-lg font-medium text-gray-900">Transaksi Berhasil!</h3>
                <p class="mt-1 text-sm text-gray-600">Transaksi baru siap dimulai.</p>
            </div>
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- KONFIGURASI ---
        // !!! PENTING: Ganti dengan URL Web App Anda dari Google Apps Script !!!
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzj-evmE5YPSsyf1dhvYaVsXd1ItYRrYdCi_wn698s0ih7I8XsrCzSvDQfwcq3vKvlk/exec";

        // --- DOM ELEMENTS ---
        const productNameInput = document.getElementById('product-name');
        const productSuggestions = document.getElementById('product-suggestions');
        const quantityInput = document.getElementById('quantity');
        const unitDisplay = document.getElementById('unit');
        const subtotalDisplay = document.getElementById('subtotal');
        const addProductBtn = document.getElementById('add-product-btn');
        const cartItemsContainer = document.getElementById('cart-items');
        const totalAmountDisplay = document.getElementById('total-amount');
        const paymentSection = document.getElementById('payment-section');
        const paymentMethodContainer = document.getElementById('payment-method');
        const cashPaymentDetails = document.getElementById('cash-payment-details');
        const cashAmountInput = document.getElementById('cash-amount');
        const changeAmountDisplay = document.getElementById('change-amount');
        const saveTransactionBtn = document.getElementById('save-transaction-btn');
        const transactionTimeDisplay = document.getElementById('transaction-time');
        const successModal = document.getElementById('success-modal');
        const decrementQtyBtn = document.getElementById('decrement-qty');
        const incrementQtyBtn = document.getElementById('increment-qty');
        const clearCashBtn = document.getElementById('clear-cash-btn');
        const exactCashBtn = document.getElementById('exact-cash-btn');

        // --- APP STATE ---
        let products = []; // Produk akan diambil dari Google Sheet
        let cart = [];
        let currentProduct = null;
        let currentPaymentMethod = null;
        let total = 0;
        let currentTransactionId = null;

        // --- FUNGSI UNTUK MENGAMBIL DATA PRODUK ---
        const fetchProducts = async () => {
            try {
                productNameInput.placeholder = "Memuat produk...";
                const response = await fetch(SCRIPT_URL);
                if (!response.ok) {
                    throw new Error(`Gagal mengambil data produk. Status: ${response.status}`);
                }
                const data = await response.json();
                if(data.error) {
                    throw new Error(data.error);
                }
                products = data;
                productNameInput.placeholder = "Ketik nama atau harga...";
                console.log("Produk berhasil dimuat:", products);
            } catch (error) {
                console.error("Error fetching products:", error);
                productNameInput.placeholder = "Error! Coba refresh.";
                alert(`Gagal memuat daftar produk: ${error.message}. Pastikan URL Apps Script benar, sudah di-deploy, dan sheet 'Produk' ada.`);
            }
        };
        
        // --- UTILITY FUNCTIONS ---
        const generateTransactionId = () => {
            const now = new Date();
            const timestamp = now.getFullYear().toString().slice(-2) +
                (now.getMonth() + 1).toString().padStart(2, '0') +
                now.getDate().toString().padStart(2, '0') +
                now.getHours().toString().padStart(2, '0') +
                now.getMinutes().toString().padStart(2, '0');
            const randomPart = Math.random().toString(36).substring(2, 6).toUpperCase();
            return `TRX-${timestamp}-${randomPart}`;
        };

        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);
        };

        const formatNumber = (num) => {
            return new Intl.NumberFormat('id-ID').format(num);
        };

        const parseNumber = (str) => {
            return parseInt(String(str).replace(/\./g, ''), 10) || 0;
        };
        
        const updateTransactionTime = () => {
            const now = new Date();
            transactionTimeDisplay.textContent = now.toLocaleString('id-ID', { dateStyle: 'full', timeStyle: 'short' });
        };

        const startNewTransaction = () => {
            currentTransactionId = generateTransactionId();
            console.log(`ID Transaksi Baru: ${currentTransactionId}`);
        };

        // --- RENDER FUNCTIONS ---
        const renderSuggestions = (filteredProducts) => {
            if (filteredProducts.length === 0) {
                productSuggestions.classList.add('hidden');
                return;
            }
            productSuggestions.innerHTML = filteredProducts.map(p => 
                `<div class="p-3 hover:bg-gray-100 cursor-pointer" data-id="${p.id}">${p.name} (${formatCurrency(p.price)}/${p.unit})</div>`
            ).join('');
            productSuggestions.classList.remove('hidden');
        };

        const renderCart = () => {
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `<p class="text-gray-400 text-center text-sm">Belum ada produk</p>`;
                paymentSection.classList.add('hidden');
                saveTransactionBtn.classList.add('hidden');
            } else {
                cartItemsContainer.innerHTML = cart.map((item, index) => `
                    <div class="flex items-center justify-between bg-gray-50 p-2 rounded-lg">
                        <div class="flex-1">
                            <p class="font-medium text-sm text-gray-800">${item.name}</p>
                            <p class="text-xs text-gray-500">${item.quantity} ${item.unit} x ${formatCurrency(item.price)}</p>
                        </div>
                        <p class="font-semibold text-sm text-gray-900 w-24 text-right">${formatCurrency(item.subtotal)}</p>
                        <button class="delete-item-btn ml-3 text-red-500 hover:text-red-700" data-index="${index}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                `).join('');
                paymentSection.classList.remove('hidden');
            }
            updateTotal();
            updateChange();
        };

        // --- CALCULATION FUNCTIONS ---
        const updateSubtotal = () => {
            const quantity = parseFloat(quantityInput.value) || 0;
            const subtotal = currentProduct ? quantity * currentProduct.price : 0;
            subtotalDisplay.textContent = formatCurrency(subtotal);
        };

        const updateTotal = () => {
            total = cart.reduce((sum, item) => sum + item.subtotal, 0);
            totalAmountDisplay.textContent = formatCurrency(total);
            updateChange();
        };
        
        const updateChange = () => {
            if (currentPaymentMethod !== 'Tunai') {
                changeAmountDisplay.textContent = formatCurrency(0);
                if (cart.length > 0) {
                    saveTransactionBtn.classList.remove('hidden');
                } else {
                    saveTransactionBtn.classList.add('hidden');
                }
                return;
            }
            const cashAmount = parseNumber(cashAmountInput.value);
            const change = cashAmount - total;
            changeAmountDisplay.textContent = formatCurrency(change >= 0 ? change : 0);
            
            if (change >= 0 && total > 0) {
                saveTransactionBtn.classList.remove('hidden');
            } else {
                saveTransactionBtn.classList.add('hidden');
            }
        };
        
        const resetForm = () => {
            cart = [];
            currentProduct = null;
            currentPaymentMethod = null;
            total = 0;
            
            productNameInput.value = '';
            quantityInput.value = '';
            unitDisplay.value = '';
            cashAmountInput.value = '';
            
            document.querySelectorAll('.payment-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('border-gray-300');
            });
            
            cashPaymentDetails.classList.add('hidden');
            clearCashBtn.classList.add('hidden');
            
            renderCart();
            updateSubtotal();
            updateTransactionTime();
            startNewTransaction();
        };

        // --- EVENT HANDLERS ---
        productNameInput.addEventListener('input', () => {
            const query = productNameInput.value.toLowerCase();
            if (query.length === 0) {
                productSuggestions.classList.add('hidden');
                return;
            }
            const filtered = products.filter(p => 
                p.name.toLowerCase().includes(query) || 
                String(p.price).includes(query)
            );
            renderSuggestions(filtered);
        });
        
        productSuggestions.addEventListener('click', (e) => {
            if (e.target.matches('[data-id]')) {
                const productId = e.target.dataset.id; 
                currentProduct = products.find(p => String(p.id) === productId); 
                
                if (currentProduct) {
                    productNameInput.value = currentProduct.name;
                    unitDisplay.value = currentProduct.unit;
                    productSuggestions.classList.add('hidden');
                    quantityInput.value = '';
                    quantityInput.focus();
                    updateSubtotal();
                }
            }
        });

        quantityInput.addEventListener('input', updateSubtotal);

        decrementQtyBtn.addEventListener('click', () => {
            let currentValue = parseFloat(quantityInput.value) || 0;
            currentValue = Math.max(0, currentValue - 0.5);
            quantityInput.value = currentValue > 0 ? currentValue : '';
            updateSubtotal();
        });

        incrementQtyBtn.addEventListener('click', () => {
            let currentValue = parseFloat(quantityInput.value) || 0;
            quantityInput.value = currentValue + 0.5;
            updateSubtotal();
        });

        addProductBtn.addEventListener('click', () => {
            const quantity = parseFloat(quantityInput.value);
            if (currentProduct && quantity > 0) {
                cart.push({ ...currentProduct, quantity, subtotal: currentProduct.price * quantity });
                renderCart();
                currentProduct = null;
                productNameInput.value = '';
                quantityInput.value = '';
                unitDisplay.value = '';
                productNameInput.focus();
                updateSubtotal();
            } else {
                alert('Pilih produk dan masukkan jumlah yang valid.');
            }
        });
        
        clearCashBtn.addEventListener('click', () => {
            cashAmountInput.value = '';
            updateChange();
            cashAmountInput.focus();
            clearCashBtn.classList.add('hidden');
        });

        cartItemsContainer.addEventListener('click', (e) => {
            const deleteBtn = e.target.closest('.delete-item-btn');
            if (deleteBtn) {
                const index = parseInt(deleteBtn.dataset.index);
                cart.splice(index, 1);
                renderCart();
            }
        });
        
        paymentMethodContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.payment-btn');
            if (!button) return;
            currentPaymentMethod = button.dataset.method;
            document.querySelectorAll('.payment-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('border-gray-300');
            });
            button.classList.add('bg-blue-600', 'text-white');
            button.classList.remove('border-gray-300');
            if (currentPaymentMethod === 'Tunai') {
                cashPaymentDetails.classList.remove('hidden');
                cashAmountInput.focus();
            } else {
                cashPaymentDetails.classList.add('hidden');
            }
            updateChange();
        });
        
        cashAmountInput.addEventListener('input', (e) => {
            const value = e.target.value;
            const number = parseNumber(value);
            
            e.target.value = formatNumber(number);

            clearCashBtn.classList.toggle('hidden', number <= 0);
            updateChange();
        });
        
        document.querySelectorAll('.cash-denomination-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const amount = parseFloat(btn.dataset.amount);
                const currentCash = parseNumber(cashAmountInput.value);
                const newTotal = currentCash + amount;
                cashAmountInput.value = formatNumber(newTotal);
                cashAmountInput.dispatchEvent(new Event('input'));
            });
        });

        exactCashBtn.addEventListener('click', () => {
            cashAmountInput.value = formatNumber(total);
            cashAmountInput.dispatchEvent(new Event('input'));
        });

        saveTransactionBtn.addEventListener('click', async () => {
            if (cart.length === 0 || !currentPaymentMethod) {
                alert('Keranjang kosong atau metode pembayaran belum dipilih.');
                return;
            }
            
            saveTransactionBtn.disabled = true;
            saveTransactionBtn.textContent = 'Menyimpan...';

            const transactionData = {
                transactionId: currentTransactionId,
                items: cart,
                totalTransaction: total,
                paymentMethod: currentPaymentMethod,
            };
            
            try {
                // Menggunakan mode 'no-cors' bisa membuat response tidak bisa dibaca,
                // jadi kita akan mencoba tanpa itu terlebih dahulu dan menggunakan redirect manual.
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(transactionData),
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8', // Apps Script lebih baik menangani text/plain untuk doPost
                    },
                });

                // Cek jika response adalah redirect, yang sering terjadi pada Apps Script
                if (response.type === 'opaque' || response.redirected) {
                     console.log("Data transaksi terkirim (kemungkinan redirect). Diasumsikan berhasil.");
                } else {
                    const result = await response.json();
                    if (result.status !== 'success') {
                         throw new Error(result.message || 'Terjadi kesalahan yang tidak diketahui dari server.');
                    }
                    console.log("Data transaksi terkirim:", result.message);
                }
                
                successModal.classList.remove('hidden');
                setTimeout(() => {
                    successModal.classList.add('hidden');
                    resetForm();
                    saveTransactionBtn.disabled = false;
                    saveTransactionBtn.textContent = 'Simpan Transaksi';
                }, 1500);

            } catch (error) {
                console.error('Gagal mengirim data:', error);
                // Menampilkan pesan error yang lebih spesifik jika ada
                alert(`Gagal menyimpan transaksi: ${error.message}. Cek koneksi internet dan konsol log.`);
                saveTransactionBtn.disabled = false;
                saveTransactionBtn.textContent = 'Simpan Transaksi';
            }
        });
        
        document.addEventListener('click', (e) => {
            if (!productNameInput.contains(e.target) && !productSuggestions.contains(e.target)) {
                productSuggestions.classList.add('hidden');
            }
        });

        // --- INITIALIZATION ---
        const initializeApp = async () => {
            if (SCRIPT_URL === "GANTI_DENGAN_URL_WEB_APP_ANDA") {
                alert("PENTING: Harap masukkan URL Web App dari Google Apps Script Anda di dalam variabel SCRIPT_URL pada kode HTML.");
                return;
            }
            renderCart();
            updateTransactionTime();
            startNewTransaction();
            await fetchProducts();
            setInterval(updateTransactionTime, 60000);
        };

        initializeApp();
    });
    </script>
</body>
</html>
```
